//#idea: insert checkup for previous day up to 30 days ago
//to see if user has used program in the last 30 days
//if not, reset values to 0

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.mycompany.spectralflask;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.Date;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.Scanner;
import javax.swing.JOptionPane;

/**
 *
 * @author user-pc
 */
public class clsSpectralFlask extends javax.swing.JFrame {

    double dRG, dWB, dNS, dMR, dVT, dAmt, dDiff;
    String sText, txtLoc, sData, sDate, sRG, sWB, sNS, sMR, sVT, sDiff, sNrFlask, databaseURL, sSQL;
    int iLocRG, iLocWB, iLocNS, iLocMR, iLocVT, iLocDiff, iNrFlask, iLocNrFlask;
    boolean noConn = false;
    SimpleDateFormat formatter = new SimpleDateFormat("yyyy/MM/dd HH:mm:ss");
    /**
     * Creates new form clsSpectralFlask
     */
    public clsSpectralFlask() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">                          
    private void initComponents() {

        btnSave = new javax.swing.JButton();
        teRG = new javax.swing.JTextField();
        teWB = new javax.swing.JTextField();
        teNS = new javax.swing.JTextField();
        teMR = new javax.swing.JTextField();
        teVT = new javax.swing.JTextField();
        lblRG = new javax.swing.JLabel();
        lblMR = new javax.swing.JLabel();
        lblWB = new javax.swing.JLabel();
        lblVT = new javax.swing.JLabel();
        lblNS = new javax.swing.JLabel();
        lblAmt = new javax.swing.JLabel();
        teDiff = new javax.swing.JTextField();
        lblFlaskPrice = new javax.swing.JLabel();
        lblDiff = new javax.swing.JLabel();
        lblDiffTitle = new javax.swing.JLabel();
        teNrFlask = new javax.swing.JTextField();
        lblNrFlask = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });

        btnSave.setText("Save");
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });

        teRG.setText("0");
        teRG.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teRGKeyReleased(evt);
            }
        });

        teWB.setText("0");
        teWB.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teWBKeyReleased(evt);
            }
        });

        teNS.setText("0");
        teNS.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                teNSFocusGained(evt);
            }
        });
        teNS.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                teNSKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teNSKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                teNSKeyTyped(evt);
            }
        });

        teMR.setText("0");
        teMR.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                teMRActionPerformed(evt);
            }
        });
        teMR.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teMRKeyReleased(evt);
            }
        });

        teVT.setText("0");
        teVT.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teVTKeyReleased(evt);
            }
        });

        lblRG.setText("Rising Glory");

        lblMR.setText("Marrowroot");

        lblWB.setText("Widowbloom");

        lblVT.setText("Vigil's Torch");

        lblNS.setText("Nightshade");

        lblAmt.setText("0");

        teDiff.setText("0");
        teDiff.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teDiffKeyReleased(evt);
            }
        });

        lblFlaskPrice.setText("Price of Flasks");

        lblDiff.setText("0");

        lblDiffTitle.setText("Difference Amount");

        teNrFlask.setText("0");
        teNrFlask.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                teNrFlaskKeyReleased(evt);
            }
        });

        lblNrFlask.setText("Number of Flasks");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btnSave, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(teVT)
                    .addComponent(teWB)
                    .addComponent(lblVT, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(lblWB, javax.swing.GroupLayout.DEFAULT_SIZE, 110, Short.MAX_VALUE)
                    .addComponent(teRG)
                    .addComponent(lblRG, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(26, 26, 26)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addComponent(lblAmt, javax.swing.GroupLayout.PREFERRED_SIZE, 226, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGroup(layout.createSequentialGroup()
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(lblFlaskPrice, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(teDiff))
                                    .addGap(116, 116, 116)))
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(teNS, javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(lblNS, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(lblMR, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 110, Short.MAX_VALUE)
                                .addComponent(teMR, javax.swing.GroupLayout.Alignment.LEADING)))
                        .addGap(0, 5, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(teNrFlask)
                            .addComponent(lblNrFlask, javax.swing.GroupLayout.DEFAULT_SIZE, 92, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(lblDiff, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lblDiffTitle, javax.swing.GroupLayout.DEFAULT_SIZE, 121, Short.MAX_VALUE))))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(25, 25, 25)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblRG)
                    .addComponent(lblNS))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(teRG, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(teNS, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(14, 14, 14)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblWB)
                    .addComponent(lblMR))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(teWB, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(teMR, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 14, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblDiffTitle)
                            .addComponent(lblNrFlask))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(teNrFlask, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblDiff, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblAmt, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(5, 5, 5))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblVT)
                            .addComponent(lblFlaskPrice))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(teVT, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(teDiff, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(14, 14, 14)
                        .addComponent(btnSave, javax.swing.GroupLayout.PREFERRED_SIZE, 91, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>                        

    private void formWindowActivated(java.awt.event.WindowEvent evt) {                                     

    }                                    

    private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {                                        

        java.util.Date date = new java.util.Date();
        sDate = formatter.format(date);
        
        try (Connection conn = DriverManager.getConnection(databaseURL)) {
            
            sSQL = "INSERT INTO tblFlaskInfo (colDate, colRG, colWB,"
                    + " colNS, colMR, colVT, colFlaskPrice) VALUES (?,"
                    + " ?, ?, ?, ?, ?, ?)";
             
            PreparedStatement preparedStatement = conn.prepareStatement(sSQL);
            preparedStatement.setString(1, sDate);
            preparedStatement.setString(2, teRG.getText());
            preparedStatement.setString(3, teWB.getText());
            preparedStatement.setString(4, teNS.getText());
            preparedStatement.setString(5, teMR.getText());
            preparedStatement.setString(6, teVT.getText());
            preparedStatement.setString(7, teDiff.getText());
            
//            troubleshoot
//            int row = preparedStatement.executeUpdate();
//            
//            if (row > 0) {
//                System.out.println("A row has been inserted successfully.");
//            }

        } catch (SQLException ex) {
            ex.printStackTrace();
        }
        
        File fnew = new File("FlaskInfo.txt");
        
        sText = "RG:" + teRG.getText() + "\n"
            + "WB:" + teWB.getText() + "\n"
            + "NS:" + teNS.getText() + "\n"
            + "MR:" + teMR.getText() + "\n"
            + "VT:" + teVT.getText() + "\n"
            + "Diff:" + teDiff.getText() + "\n"
            + "NrFlask:" + teNrFlask.getText();
        try {
            FileWriter fw = new FileWriter(fnew, false);
            fw.write(sText);
            fw.close();
        } catch (IOException e) {
            System.out.println(e);
        }
    }                                      

    private void teNSKeyReleased(java.awt.event.KeyEvent evt) {                                 
        calcTotal();
    }                                

    private void teRGKeyReleased(java.awt.event.KeyEvent evt) {                                 
        calcTotal();
    }                                

    private void teMRKeyReleased(java.awt.event.KeyEvent evt) {                                 
        calcTotal();
    }                                

    private void teWBKeyReleased(java.awt.event.KeyEvent evt) {                                 
        calcTotal();
    }                                

    private void teVTKeyReleased(java.awt.event.KeyEvent evt) {                                 
        calcTotal();
    }                                

    private void teDiffKeyReleased(java.awt.event.KeyEvent evt) {                                   
        calcTotal();
    }                                  

    private void formWindowOpened(java.awt.event.WindowEvent evt) {                                  
        teRG.setText("0");
        teWB.setText("0");
        teNS.setText("0");
        teMR.setText("0");
        teVT.setText("0");
        teDiff.setText("0");
        teNrFlask.setText("0");
        
        txtLoc = "FlaskInfo.txt";
        databaseURL = "jdbc:ucanaccess://D://Dev//Java//SpectralFlask//SpectralFlask//FlaskInfoDB.accdb";

        try {
            File fileLoc = new File(txtLoc);
            Scanner myReader = new Scanner(fileLoc);
            while (myReader.hasNextLine()) {
                sData = sData + myReader.nextLine();
            }
            myReader.close();
        } catch (FileNotFoundException e) {
            JOptionPane.showMessageDialog(null, """
                                                FlaskInfo.txt could not be found.
                                                Resetting values to zero(0).""");
        }
        
        try {
            iLocRG = sData.indexOf("RG:");
            iLocWB = sData.indexOf("WB:");
            iLocNS = sData.indexOf("NS:");
            iLocMR = sData.indexOf("MR:");
            iLocVT = sData.indexOf("VT:");
            iLocDiff = sData.indexOf("Diff:");
            iLocNrFlask = sData.indexOf("NrFlask:");
            
            sRG = sData.substring(iLocRG + 3, iLocWB);
            sWB = sData.substring(iLocWB + 3, iLocNS);
            sNS = sData.substring(iLocNS + 3, iLocMR);
            sMR = sData.substring(iLocMR + 3, iLocVT);
            sVT = sData.substring(iLocVT + 3, iLocDiff);
            sDiff = sData.substring(iLocDiff + 5, iLocNrFlask);
            sNrFlask = sData.substring(iLocNrFlask + 8);
            
            teRG.setText(sRG);
            teWB.setText(sWB);
            teNS.setText(sNS);
            teMR.setText(sMR);
            teVT.setText(sVT);
            teDiff.setText(sDiff);
            teNrFlask.setText(sNrFlask);
            
            calcTotal();
        } catch (Exception e) {
            System.out.println(e);
        }
    }                                 

    private void teNSFocusGained(java.awt.event.FocusEvent evt) {                                 
        // TODO add your handling code here:
    }                                

    private void teMRActionPerformed(java.awt.event.ActionEvent evt) {                                     
        // TODO add your handling code here:
    }                                    

    private void teNrFlaskKeyReleased(java.awt.event.KeyEvent evt) {                                      
        calcTotal();
    }                                     

    private void calcTotal() {
        try {
            dRG = Double.parseDouble(teRG.getText()) * 4;
            dWB = Double.parseDouble(teWB.getText()) * 4;
            dNS = Double.parseDouble(teNS.getText()) * 3;
            dMR = Double.parseDouble(teMR.getText()) * 4;
            dVT = Double.parseDouble(teVT.getText()) * 4;
            dAmt = dRG + dWB + dNS + dMR + dVT;
            dDiff = (Double.parseDouble(teDiff.getText())) * 0.95f - dAmt;
            iNrFlask = Integer.parseInt(teNrFlask.getText());
            
            dAmt *= iNrFlask;
            dDiff *= iNrFlask;
            
            dAmt = Math.round(dAmt * 100.0) / 100.0;
            dDiff = Math.round(dDiff * 100.0) / 100.0;
            
            lblAmt.setText(dAmt + " Gold for materials");
            lblDiff.setText(dDiff + " Gold");
        } catch (NumberFormatException e) {
            lblAmt.setText("Err: " + e);
            lblDiff.setText("Err: " + e);
        }
    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new clsSpectralFlask().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify                     
    private javax.swing.JButton btnSave;
    private javax.swing.JLabel lblAmt;
    private javax.swing.JLabel lblDiff;
    private javax.swing.JLabel lblDiffTitle;
    private javax.swing.JLabel lblFlaskPrice;
    private javax.swing.JLabel lblMR;
    private javax.swing.JLabel lblNS;
    private javax.swing.JLabel lblNrFlask;
    private javax.swing.JLabel lblRG;
    private javax.swing.JLabel lblVT;
    private javax.swing.JLabel lblWB;
    private javax.swing.JTextField teDiff;
    private javax.swing.JTextField teMR;
    private javax.swing.JTextField teNS;
    private javax.swing.JTextField teNrFlask;
    private javax.swing.JTextField teRG;
    private javax.swing.JTextField teVT;
    private javax.swing.JTextField teWB;
    // End of variables declaration                   
}
